<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:b="http://richfaces.org/sandbox/bootstrap">



<h:head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></meta>
	<meta name="viewport" content="width=device-width, initial-scale=1"></meta>

	<h:outputStylesheet library="css" name="bootstrap.css" />

	<style>
body {
	padding-top: 40px !important;;
	padding-bottom: 40px !important;;
	background-color: #eee !important;;

}

.centering {
 margin-left: auto;
  margin-right: auto;

}


</style>
	<title>Administrator</title>
</h:head>
<h:body>

	<f:view>
		




			<h:commandButton class="btn pull-right" value="Logout"
				action="#{AdministratorBean.logout}"></h:commandButton>
			<h:outputLabel value="User:" class="btn pull-right" />
			<h:outputText value="#{LoginBean.username}" class="btn pull-right" />


<ul class="nav nav-tabs">
  <li class="active"><a href="#task" data-toggle="tab">Tasks</a></li>
  <li><a href="#usermanagement" data-toggle="tab">User Management</a></li>
  <li><a href="#changepassword" data-toggle="tab">Change Password</a></li>
  <li><a href="#organizationmanagement" data-toggle="tab">Organization Management</a></li>
</ul>

<div class="tab-content">
			

			 <div class="tab-pane active" id="task">
<a4j:commandButton styleClass="btn btn-default"
									value="UnPublish Task"
									
									oncomplete="$('#myModal').modal('show')"
									rendered="#{o.renderUnpublish}" />
<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">dd</button>
        <h4 class="modal-title" id="myModalLabel">Modal title</h4>
      </div>
      <div class="modal-body">
        ...
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>
					<div class="container centering">

						<div class="row">
							<table class="span6">


								<tr>
									<td><h:outputText value="Name of task:" /> <h:inputText
											value="#{AdministratorBean.name}" /></td>
								</tr>
								<tr>
									<td><h:outputText value="Load XML FILE" /></td>
								</tr>


								<tr>
									<td><rich:fileUpload
											fileUploadListener="#{AdministratorBean.listener}"
											id="upload" maxFilesQuantity="1" /></td>
								</tr>
								<tr>
									<td><h:commandButton class="btn btn-default"
											value="Create task"
											action="#{AdministratorBean.createTask()}" /></td>
								</tr>
							</table>

							<table class="span6">
								<tr>
									<td><h:outputText value="Enter String to find:" /></td>
									<td><h:inputText type="text" class="form-control" value="#{AdministratorBean.nieco}" /></td>
								</tr>



								<tr>
									<td><h:outputText value="Select option to find" /></td>
									<td><rich:select  defaultLabel="Select option" value="#{AdministratorBean.findOption}">
                <f:selectItem itemValue="ID" itemLabel="ID" />
                <f:selectItem itemValue="Permission" itemLabel="Permission" />
                <f:selectItem itemValue="Owner" itemLabel="Owner" />
            </rich:select></td>


								</tr>



								<tr>
									<td><h:commandButton class="btn btn-default btn-lg"
											value="Find" action="#{AdministratorBean.findList}" /></td>
								</tr>
							</table>

						</div>
					</div>









					<a4j:poll action="#{AdministratorBean.updateTasks()}"
						interval="100" reRender="userTab"
						enabled="#{AdministratorBean.renderPoll}">
					</a4j:poll>
					<a4j:poll interval="100" reRender="editUser" enabled="true">
					</a4j:poll>


					<h:dataTable value="#{AdministratorBean.task}" var="o"
						class="table table-hover" id="userTab" rows="5">
										
						<h:column>

							<f:facet name="header">
							<h:form>
						<h:commandLink  action="#{AdministratorBean.sortById}" >	
							
									<h:outputText value="ID"></h:outputText>
							</h:commandLink>
							</h:form>
							</f:facet>
							<h:outputText value="#{o.id}"></h:outputText>

						</h:column>
						<h:column>

							<f:facet name="header">
							<h:form>
								<h:commandLink action="#{AdministratorBean.sortByName}">
									<h:outputText value="Name"></h:outputText>
								</h:commandLink>
							</h:form>
							</f:facet>


							<h:outputText value="#{o.name}" />

						</h:column>

						<h:column>

							<f:facet name="header">
								<h:column>
								<h:form>
									<h:commandLink action="#{AdministratorBean.sortByState}">
										<h:outputText value="State"></h:outputText>
									</h:commandLink>
							</h:form>
								</h:column>
							</f:facet>
							<h:outputText value="#{o.state}"></h:outputText>
						</h:column>
						<h:column>

							<f:facet name="header">
								<h:column>
									<h:outputText value="Progress"></h:outputText>
								</h:column>
							</f:facet>
							<rich:progressBar interval="100" value="#{o.progress}"></rich:progressBar>


						</h:column>

						<h:column>

							<f:facet name="header">
								<h:column>
								<h:form>
									<h:commandLink action="#{AdministratorBean.sortByETA}">
										<h:outputText value="ETA"></h:outputText>
									</h:commandLink>
								</h:form>
								</h:column>
							</f:facet>

							<h:outputText value="#{o.estimatedTime}"></h:outputText>

						</h:column>

						<h:column>

							<f:facet name="header">
								<h:column>
								<h:form>
									<h:commandLink action="#{AdministratorBean.sortByPermission}">
										<h:outputText value="Permission"></h:outputText>
									</h:commandLink>
									</h:form>
								</h:column>
							</f:facet>
							<h:outputText value="#{o.ifPublic}"></h:outputText>
						</h:column>

						<h:column>

							<f:facet name="header">
								<h:column>
								<h:form>
									<h:commandLink action="#{AdministratorBean.sortByOwner}">
										<h:outputText value="Owner"></h:outputText>
									</h:commandLink>
								</h:form>
								</h:column>
							</f:facet>
							<h:outputText value="#{o.owner}"></h:outputText>



						</h:column>

						<h:column>

							<f:facet name="header">
								<h:column>
									<h:outputText value="Actions"></h:outputText>
								</h:column>
							</f:facet>
							<h:panelGrid columns="6">

								<h:commandButton class="btn btn-default" value="Edit Task"
									action="#{AdministratorBean.editXmlFile(o)}"
									rendered="#{o.renderEdit}" />
								<h:commandButton class="btn btn-default" value="Stop task"
									action="#{AdministratorBean.stopTask(o)}"
									rendered="#{o.renderStop}" />
								<h:commandButton class="btn btn-default" value="Run task"
									action="#{AdministratorBean.runTask(o)}"
									rendered="#{o.renderRun}" />
								<a4j:commandButton styleClass="btn btn-default"
									value="UnPublish Task"
									action="#{AdministratorBean.unpublishTask(o)}"
									oncomplete="$('#myModal').modal('show')"
									rendered="#{o.renderUnpublish}" />
								<a4j:commandButton styleClass="btn btn-default"
									value="Publish Task"
									action="#{AdministratorBean.publishTask(o)}"
									oncomplete="$('#myModal').modal('show')"
									rendered="#{o.renderPublish}" />

								<h:commandButton class="btn btn-default" value="delete task"
									action="#{AdministratorBean.deleteTask(o)}"
									rendered="#{o.renderDelete}" />



<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">close</button>
        <h4 class="modal-title" id="myModalLabel">Publish task</h4>
      </div>
      <div class="modal-body">
     
    
      <h:outputText value="#{AdministratorBean.publishInformation}" />
 
     
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
    
      </div>
    </div>
  </div>
</div>











								<rich:popupPanel id="popup" modal="false" autosized="true"
									resizeable="false">

									<h:panelGrid columns="1">
										<h:outputText
											value="#{AdministratorBean.unpublishInformation}" />


										<h:outputLink value="#"
											onclick="#{rich:component('popup')}.hide(); return false;">
                    Close Window
                </h:outputLink>


									</h:panelGrid>

								</rich:popupPanel>







							</h:panelGrid>
						</h:column>

					</h:dataTable>
					<table>
						<tr>
							<td><rich:dataScroller for="userTab" maxPages="5" /></td>
						</tr>

						<tr>
							<td><h:commandButton class="btn btn-default"
									value="Show all tasks"
									action="#{AdministratorBean.saveActionTask()}" /></td>
						</tr>
					</table>
				
					</div>
				
		

				<div class="tab-pane" id="usermanagement">
						<div class="container">
							<div class="row">
								<table class="span6">
									<tr>
										<td><h:outputText value="Enter String to find:" /></td>
										<td><h:inputText value="#{AdministratorBean.nieco}" /></td>
									</tr>



									<tr>
										<td><h:outputText value="Select option to find" /></td>
										<td><rich:select  defaultLabel="Select option" value="#{AdministratorBean.findOption}">
                <f:selectItem itemValue="Username" itemLabel="Username" />
                <f:selectItem itemValue="Organization" itemLabel="Organization" />
                <f:selectItem itemValue="Email" itemLabel="Email" />
                   <f:selectItem itemValue="Role" itemLabel="Role" />
            </rich:select></td>


									</tr>



									<tr>
										<td><h:commandButton class="btn btn-default btn-lg"
												value="Find" action="#{AdministratorBean.findListOrganization}" /></td>
									</tr>
								</table>




								<table class="span6">
									<tr>
										<td>Username:</td>
										<td><h:inputText value="#{AdministratorBean.username}" />
										</td>
									</tr>
									<tr>
										<td>Password:</td>
										<td><h:inputText value="#{AdministratorBean.pass}" /></td>
									</tr>
									<tr>
										<td>Re-type password:</td>
										<td><h:inputText
												value="#{AdministratorBean.passwordValidate}" /></td>
									</tr>
									<tr>
										<td>Email:</td>
										<td><h:inputText value="#{AdministratorBean.email}" /></td>
									</tr>
									<tr>
										<td>Organization:</td>
										<td><rich:select
												value="#{AdministratorBean.organization}"
												showControls="true">


												<f:selectItems
													value="#{AdministratorBean.editableOrganizations}"
													id="editOrg" />
											</rich:select></td>
									</tr>
									<tr>
										<td>Role:</td>
										<td><rich:select value="#{AdministratorBean.role}"
												defaultLabel="Click here to edit">
												<f:selectItem itemValue="Reader" itemLabel="Reader" />
												<f:selectItem itemValue="Administrator"
													itemLabel="Administrator" />
												<f:selectItem itemValue="Planner" itemLabel="Planner" />

											</rich:select></td>
									</tr>
									<tr>
										<td><h:commandButton class="btn btn-default"
												value="Create User"
												action="#{AdministratorBean.createUser()}" /></td>
									</tr>
								</table>

							</div>
						</div>
				<h:form>
					<a4j:region id="ren" selfRendered="true">
						<a4j:poll
							action="#{AdministratorBean.updateEditableOrganizations()}"
							interval="300" ajaxSingle="true" limitToList="true"
							bypassUpdates="true">
						</a4j:poll>
						<a4j:poll reRender="editUSER" interval="100">
						</a4j:poll>

					</a4j:region>
					<h:dataTable value="#{AdministratorBean.user}" var="po"
						styleClass="order-table" headerClass="order-table-header"
						rowClasses="order-table-odd-row,order-table-even-row"
						id="editUSER" rows="10" class="table">

						<h:column>

							<f:facet name="header">
								<h:column>
									<h:commandLink action="#{AdministratorBean.sortByUsername}">
										<h:outputText value="Username"></h:outputText>
									</h:commandLink>
								</h:column>
							</f:facet>
							<h:inputText value="#{po.username}" size="10"
								rendered="#{po.editable}" />

							<h:outputText value="#{po.username}"
								rendered="#{not po.editable}" />
						</h:column>






						<h:column>

							<f:facet name="header">password</f:facet>



							<h:outputText value="#{po.password}" />

						</h:column>

						<h:column>

							<f:facet name="header">
								<h:column>
									<h:commandLink action="#{AdministratorBean.sortByEmail}">
										<h:outputText value="Email"></h:outputText>
									</h:commandLink>
								</h:column>
							</f:facet>
							<h:inputText value="#{po.email}" size="10"
								rendered="#{po.editable}" />

							<h:outputText value="#{po.email}" rendered="#{not po.editable}" />
						</h:column>

						<h:column>

							<f:facet name="header">
								<h:column>
									<h:commandLink action="#{AdministratorBean.sortByRole}">
										<h:outputText value="Role"></h:outputText>
									</h:commandLink>
								</h:column>
							</f:facet>
							<rich:select value="#{po.role}"
								defaultLabel="Click here to edit" rendered="#{po.editable}">
								<f:selectItem itemValue="Reader" itemLabel="Reader" />
								<f:selectItem itemValue="Administrator"
									itemLabel="Administrator" />
								<f:selectItem itemValue="Planner" itemLabel="Planner" />

							</rich:select>

							<h:outputText value="#{po.role}" rendered="#{not po.editable}" />
						</h:column>

						<h:column>

							<f:facet name="header">
								<h:column>
									<h:commandLink action="#{AdministratorBean.sortByOrganization}">
										<h:outputText value="Organization"></h:outputText>
									</h:commandLink>
								</h:column>
							</f:facet>

							<rich:select value="#{po.organization}"
								showControls="true" rendered="#{po.editable}">


								<f:selectItems
									value="#{AdministratorBean.editableOrganizations}" id="editOrg" />
							</rich:select>




							<h:outputText value="#{po.organization}"
								rendered="#{not po.editable}" />
						</h:column>



						<h:column>

							<f:facet name="header">Action</f:facet>

							<h:panelGrid columns="3">
								<h:commandButton class="btn btn-default" value="Edit User"
									action="#{AdministratorBean.editAction(po)}"
									rendered="#{not po.editable}" />
								<h:commandButton class="btn btn-default" value="Delete User"
									action="#{AdministratorBean.deleteUser(po)}" />
								<a4j:commandButton styleClass="btn btn-default"
									value="Change Password"
									oncomplete="#{rich:component('popup5')}.show()"
									action="#{AdministratorBean.updateUser(po)}">
								</a4j:commandButton>


								<rich:popupPanel id="popup5" modal="false" autosized="true"
									resizeable="false">
									<h:form>
										<h:panelGrid columns="2">
											<h:outputText value="Password" />
											<h:inputText value="#{AdministratorBean.pass}"></h:inputText>
											<h:outputText value="Re-type Password" />
											<h:inputText value="#{AdministratorBean.passwordValidate}"></h:inputText>
										</h:panelGrid>
										<a4j:commandButton styleClass="btn btn-default"
											value="Change password"
											action="#{AdministratorBean.changePassword()}"
											oncomplete="#{rich:component('popup5')}.hide()" />


										<h:outputLink value="#"
											onclick="#{rich:component('popup5')}.hide(); return false;">
                    Close Window
                </h:outputLink>



									</h:form>


								</rich:popupPanel>

							</h:panelGrid>

						</h:column>

					</h:dataTable>
					<table>
						<tr>
							<td><rich:dataScroller for="editUSER" maxPages="10" /></td>
						</tr>
						<tr>
							<td><h:commandButton class="btn btn-default"
									value="Save Changes" action="#{AdministratorBean.saveAction}" /></td>
						</tr>
						<tr><td><h:commandButton class="btn btn-default" value="Show all users" action="#{AdministratorBean.showAllUsers}" /></td></tr>
					</table>



</h:form>


		</div>
				 <div class="tab-pane" id="changepassword">
					<div class="container">
					<h:panelGrid column="1">




						<h:outputLabel for="password" value="Password : " />
						<h:inputSecret type="text" class="form-control" placeholder="Username" id="password" value="#{AdministratorBean.password}" />
						<h:message id="confirmPassword" />

						<h:outputLabel for="confirmPassword" value="Confirm password : " />
						<h:inputSecret type="text" class="form-control" placeholder="Username" value="#{AdministratorBean.passwordValidate}" />

						<h:commandButton class="btn btn-default" action="#{AdministratorBean.validatePassword()}"
							value="Change password" />

					</h:panelGrid>
					</div>
				</div>
			  <div class="tab-pane" id="organizationmanagement">

				<div class="container">
				<div class="row">

				<table class="span6">
								<tr>
									<td><h:outputText value="Enter String to find:" /></td>
									<td><h:inputText type="text" class="form-control" value="#{AdministratorBean.nieco}" /></td>
								</tr>



								<tr>
									<td><rich:select  defaultLabel="Select option" value="#{AdministratorBean.findOption}">
                <f:selectItem itemValue="ID" itemLabel="ID" />
                <f:selectItem itemValue="Name of Organization" itemLabel="Name of Organization" />
              </rich:select></td>


								</tr>



								<tr>
									<td><h:commandButton class="btn btn-default btn-lg"
											value="Find" action="#{AdministratorBean.findListOrg}" /></td>
								</tr>
							</table>





				<table class="span6">
						<tr><td><h:outputText value="Organization" /></td><td>
						<h:inputText type="text" class="form-control" id="Organization"
							value="#{AdministratorBean.organization}" /></td></tr>



					<tr><td><h:commandButton class="btn btn-default" action="#{AdministratorBean.createOrganization}"
						value="Create organization" /></td></tr>
				</table>
				</div>
				</div>

		<h:form>
					<a4j:region>
						<h:form>
							<a4j:poll id="poll" interval="50" enabled="true"
								reRender="poll,tabOrg" />
						</h:form>
					</a4j:region>
					<h:dataTable value="#{AdministratorBean.organizations}" var="org"
						class="table table-hover" rows="10"
						 id="tabOrg">

						<h:column>

							<f:facet name="header">
								<h:commandLink action="#{AdministratorBean.sortByIdOrg}">
									<h:outputText value="ID Organization"></h:outputText>
								</h:commandLink>
							</f:facet>
							<h:outputText value="#{org.idOrganization}"></h:outputText>

						</h:column>


						<h:column>

							<f:facet name="header">
								<h:commandLink action="#{AdministratorBean.sortByNameOrganization}">
									<h:outputText value="Name of Organization"></h:outputText>
								</h:commandLink>
							</f:facet>
							<h:inputText value="#{org.nameOfOrganization}"
								rendered="#{org.editable}" />




							<h:outputText value="#{org.nameOfOrganization}"
								rendered="#{not org.editable}" />

						</h:column>




						<h:column>

							<f:facet name="header">Action</f:facet>

							<h:panelGrid columns="3">
								<h:commandButton class="btn btn-default" value="Edit Organization"
									action="#{AdministratorBean.editActionOrganization(org)}"
									rendered="#{not org.editable}" />
								<h:commandButton class="btn btn-default" value="Delete Organization"
									action="#{AdministratorBean.deleteOrganization(org)}" />

							</h:panelGrid>

						</h:column>

					</h:dataTable>
					<table>
				<tr><td><rich:dataScroller for="tabOrg" maxPages="10" /></td></tr>
					<tr><td><h:commandButton class="btn btn-default" value="Save Changes" action="#{AdministratorBean.saveActionOrganization}" /> </td></tr>
		<tr><td><h:commandButton value="Show all organization" class="btn btn-default" action="#{AdministratorBean.showAllOrganizations()}" /></td></tr>
		</table>
		</h:form>
		</div>
				
</div>
	</f:view>
	<h:outputScript library="js" name="bootstrap.js" />
	<h:outputScript library="js" name="jquery-2.1.0.js" />
</h:body>
</html>